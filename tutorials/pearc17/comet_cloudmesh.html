<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Comet Cloudmesh Tutorial &#8212; cloudmesh.comet 1.4.3 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.4.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          cloudmesh.comet</a>
        <span class="navbar-text navbar-version pull-left"><b>1.4.3</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/cloudmesh/cloudmesh.cmd5/blob/master/README.rst">CMD5</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Comet Cloudmesh Tutorial</a><ul>
<li><a class="reference internal" href="#status-of-this-tutorial">Status of this Tutorial</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#install-cloudmesh-client-tool-to-access-comet-vc">Install Cloudmesh Client tool to access Comet VC</a><ul>
<li><a class="reference internal" href="#cloudmesh-client-tool-in-pearc17-virtualbox-appliance">Cloudmesh Client tool in PEARC17 VirtualBox Appliance</a><ul>
<li><a class="reference internal" href="#step-1-install-virtual-box">Step 1: Install Virtual Box</a></li>
<li><a class="reference internal" href="#step-2-download-comet-pearc17-virtualbox-appliance">Step 2: Download Comet PEARC17 VirtualBox Appliance</a></li>
<li><a class="reference internal" href="#step-3-import-comet-pearc17-virtualbox-appliance">Step 3: Import Comet PEARC17 VirtualBox Appliance</a></li>
<li><a class="reference internal" href="#step-4-run-comet-pearc17-virtualbox-appliance">Step 4: Run Comet PEARC17 VirtualBox Appliance</a></li>
<li><a class="reference internal" href="#step-5-open-terminal-in-comet-pearc17-virtualbox-appliance">Step 5: Open Terminal in Comet PEARC17 VirtualBox Appliance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cloudmesh-client-tool-in-empty-virtual-box-machine">Cloudmesh Client tool in empty Virtual Box Machine</a><ul>
<li><a class="reference internal" href="#id1">Step 1: Install Virtual Box</a></li>
<li><a class="reference internal" href="#step-2-download-a-virtualbox-image">Step 2: Download a VirtualBox Image</a></li>
<li><a class="reference internal" href="#step-3-create-a-virtualbox-machine">Step 3: Create a VirtualBox Machine</a></li>
<li><a class="reference internal" href="#step-4-associate-the-vm-iso">Step 4: Associate the VM ISO</a></li>
<li><a class="reference internal" href="#step-5-start-the-vm">Step 5: Start the vm</a></li>
<li><a class="reference internal" href="#step-6-start-a-terminal">Step 6: Start a terminal</a></li>
<li><a class="reference internal" href="#step-7-vm-guest-additions">Step 7: VM guest additions</a></li>
<li><a class="reference internal" href="#step-8-install-cloudmesh">Step 8: Install cloudmesh</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cloudmesh-client-tool-installed-directly-in-macos">Cloudmesh Client Tool Installed Directly in MacOS</a></li>
<li><a class="reference internal" href="#cloudmesh-client-tool-installed-directly-in-linux">Cloudmesh Client Tool Installed Directly in Linux</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-cloudmesh-client-tool-to-access-comet-vc">Using Cloudmesh Client tool to access Comet VC</a></li>
<li><a class="reference internal" href="#virtual-cluster-architecture">Virtual Cluster Architecture</a></li>
<li><a class="reference internal" href="#getting-access-to-your-cluster">Getting access to your cluster</a></li>
<li><a class="reference internal" href="#install-the-vc-front-end-node">Install the VC front-end node</a></li>
<li><a class="reference internal" href="#configuring-the-front-end-node">Configuring the front-end node</a></li>
<li><a class="reference internal" href="#install-vc-compute-nodes">Install VC Compute Nodes</a></li>
<li><a class="reference internal" href="#demo1-verifying-infiniband-performance">DEMO1: Verifying InfiniBand Performance</a></li>
<li><a class="reference internal" href="#demo2-osu-micro-benchmarks">DEMO2: OSU Micro-Benchmarks</a></li>
<li><a class="reference internal" href="#demo3-bigdata-analytical-software-stack-deployment-and-example-run">DEMO3: Bigdata analytical software stack deployment and example run</a></li>
<li><a class="reference internal" href="#demo4-optional-openfoam">DEMO4 (optional): OpenFOAM</a></li>
<li><a class="reference internal" href="#demo5-optional-julia">DEMO5 (optional): Julia</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="../../_sources/tutorials/pearc17/comet_cloudmesh.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="comet-cloudmesh-tutorial">
<span id="comet-tut"></span><h1>Comet Cloudmesh Tutorial<a class="headerlink" href="#comet-cloudmesh-tutorial" title="Permalink to this headline">Â¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">Page Contents</p>
<div class="contents local last topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#status-of-this-tutorial" id="id24">Status of this Tutorial</a></li>
<li><a class="reference internal" href="#overview" id="id25">Overview</a></li>
<li><a class="reference internal" href="#requirements" id="id26">Requirements</a></li>
<li><a class="reference internal" href="#install-cloudmesh-client-tool-to-access-comet-vc" id="id27">Install Cloudmesh Client tool to access Comet VC</a><ul>
<li><a class="reference internal" href="#cloudmesh-client-tool-in-pearc17-virtualbox-appliance" id="id28">Cloudmesh Client tool in PEARC17 VirtualBox Appliance</a><ul>
<li><a class="reference internal" href="#step-1-install-virtual-box" id="id29">Step 1: Install Virtual Box</a></li>
<li><a class="reference internal" href="#step-2-download-comet-pearc17-virtualbox-appliance" id="id30">Step 2: Download Comet PEARC17 VirtualBox Appliance</a></li>
<li><a class="reference internal" href="#step-3-import-comet-pearc17-virtualbox-appliance" id="id31">Step 3: Import Comet PEARC17 VirtualBox Appliance</a></li>
<li><a class="reference internal" href="#step-4-run-comet-pearc17-virtualbox-appliance" id="id32">Step 4: Run Comet PEARC17 VirtualBox Appliance</a></li>
<li><a class="reference internal" href="#step-5-open-terminal-in-comet-pearc17-virtualbox-appliance" id="id33">Step 5: Open Terminal in Comet PEARC17 VirtualBox Appliance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cloudmesh-client-tool-in-empty-virtual-box-machine" id="id34">Cloudmesh Client tool in empty Virtual Box Machine</a><ul>
<li><a class="reference internal" href="#id1" id="id35">Step 1: Install Virtual Box</a></li>
<li><a class="reference internal" href="#step-2-download-a-virtualbox-image" id="id36">Step 2: Download a VirtualBox Image</a></li>
<li><a class="reference internal" href="#step-3-create-a-virtualbox-machine" id="id37">Step 3: Create a VirtualBox Machine</a></li>
<li><a class="reference internal" href="#step-4-associate-the-vm-iso" id="id38">Step 4: Associate the VM ISO</a></li>
<li><a class="reference internal" href="#step-5-start-the-vm" id="id39">Step 5: Start the vm</a></li>
<li><a class="reference internal" href="#step-6-start-a-terminal" id="id40">Step 6: Start a terminal</a></li>
<li><a class="reference internal" href="#step-7-vm-guest-additions" id="id41">Step 7: VM guest additions</a></li>
<li><a class="reference internal" href="#step-8-install-cloudmesh" id="id42">Step 8: Install cloudmesh</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cloudmesh-client-tool-installed-directly-in-macos" id="id43">Cloudmesh Client Tool Installed Directly in MacOS</a></li>
<li><a class="reference internal" href="#cloudmesh-client-tool-installed-directly-in-linux" id="id44">Cloudmesh Client Tool Installed Directly in Linux</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-cloudmesh-client-tool-to-access-comet-vc" id="id45">Using Cloudmesh Client tool to access Comet VC</a></li>
<li><a class="reference internal" href="#virtual-cluster-architecture" id="id46">Virtual Cluster Architecture</a></li>
<li><a class="reference internal" href="#getting-access-to-your-cluster" id="id47">Getting access to your cluster</a></li>
<li><a class="reference internal" href="#install-the-vc-front-end-node" id="id48">Install the VC front-end node</a></li>
<li><a class="reference internal" href="#configuring-the-front-end-node" id="id49">Configuring the front-end node</a></li>
<li><a class="reference internal" href="#install-vc-compute-nodes" id="id50">Install VC Compute Nodes</a></li>
<li><a class="reference internal" href="#demo1-verifying-infiniband-performance" id="id51">DEMO1: Verifying InfiniBand Performance</a></li>
<li><a class="reference internal" href="#demo2-osu-micro-benchmarks" id="id52">DEMO2: OSU Micro-Benchmarks</a></li>
<li><a class="reference internal" href="#demo3-bigdata-analytical-software-stack-deployment-and-example-run" id="id53">DEMO3: Bigdata analytical software stack deployment and example run</a></li>
<li><a class="reference internal" href="#demo4-optional-openfoam" id="id54">DEMO4 (optional): OpenFOAM</a></li>
<li><a class="reference internal" href="#demo5-optional-julia" id="id55">DEMO5 (optional): Julia</a></li>
</ul>
</div>
</div>
<p><strong>Goal</strong>: Install a Comet Virtual Cluster (VC) with Ubuntu 16.04, and run examples.</p>
<p><strong>Time</strong>: ~1 to 2 hours.</p>
<div class="section" id="status-of-this-tutorial">
<h2><a class="toc-backref" href="#id24">Status of this Tutorial</a><a class="headerlink" href="#status-of-this-tutorial" title="Permalink to this headline">Â¶</a></h2>
<p>Released for PEARC17 Tutorial - <a class="reference external" href="http://sched.co/AQ3H">Using Cometâs Virtual Clusters</a></p>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id25">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">Â¶</a></h2>
<p>In this tutorial you will learn how to install a Comet virtual cluster. This
includes manually install the front-end node from an attached OS ISO; running
some configuration scripts to configure the front-end behaving as a NAT router,
DHCP/TFTP and PXE-booting server; booting the compute nodes, which will be
automatically installed and configured; and running some testing examples.</p>
</div>
<div class="section" id="requirements">
<h2><a class="toc-backref" href="#id26">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li>Experience with Linux system installation and management and, ideally, with HPC cluster management.</li>
<li>Knowledge of Git, shell scripting, and Python.</li>
<li>A Comet Virtual Cluster (vctNN) assigned to you.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Scripts used in this tutorial are maintained at:</p>
<ul class="last simple">
<li><a class="reference external" href="https://github.com/cloudmesh/cloudmesh.comet.vcdeploy">https://github.com/cloudmesh/cloudmesh.comet.vcdeploy</a></li>
</ul>
</div>
</div>
<div class="section" id="install-cloudmesh-client-tool-to-access-comet-vc">
<h2><a class="toc-backref" href="#id27">Install Cloudmesh Client tool to access Comet VC</a><a class="headerlink" href="#install-cloudmesh-client-tool-to-access-comet-vc" title="Permalink to this headline">Â¶</a></h2>
<p>First we will need to install the Cloudmesh Client to access and manage the VC
on Comet. The tool could be easily installed via <code class="code docutils literal"><span class="pre">pip</span> <span class="pre">install</span>
<span class="pre">cloudmesh_client</span></code>, however installation of the dependent system libraries varies
from OS to OS. We provided a preconfigured VirtualBox appliance to ensure a
proper environment has been setup. Alternately, you can choose to install the
client tool directly on your machine.</p>
<div class="section" id="cloudmesh-client-tool-in-pearc17-virtualbox-appliance">
<h3><a class="toc-backref" href="#id28">Cloudmesh Client tool in PEARC17 VirtualBox Appliance</a><a class="headerlink" href="#cloudmesh-client-tool-in-pearc17-virtualbox-appliance" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="step-1-install-virtual-box">
<h4><a class="toc-backref" href="#id29">Step 1: Install Virtual Box</a><a class="headerlink" href="#step-1-install-virtual-box" title="Permalink to this headline">Â¶</a></h4>
<p>For convenience we will be using Ubuntu Xenial in this demo to install the
Cloudmesh client on it.</p>
<p>Please make sure you have <a class="reference external" href="https://www.virtualbox.org">VirtualBox</a> installed
(<a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">downloads page</a>). Make sure to
download and install both the <strong>platform packages</strong> and <strong>Extension Pack</strong>.</p>
</div>
<div class="section" id="step-2-download-comet-pearc17-virtualbox-appliance">
<h4><a class="toc-backref" href="#id30">Step 2: Download Comet PEARC17 VirtualBox Appliance</a><a class="headerlink" href="#step-2-download-comet-pearc17-virtualbox-appliance" title="Permalink to this headline">Â¶</a></h4>
<p>For PEARC17 we provide a pre-installed VirtualBox Appliance for download on the
internal PEARC17 web server. You should be able to download the appliance file
fromâ¦</p>
<ul class="simple">
<li><a class="reference external" href="http://bit.ly/pearc17-comet-ova">Comet PEARC17 VirtualBox Appliance (CometPEARC17.ova)</a></li>
</ul>
<p>â¦and remember the location where you downloaded it. You will need that
location later.</p>
<p>After downloading the Comet PEARC17 VirtualBox Appliance locate it on your
machine.</p>
<div class="figure" id="id5">
<a class="reference internal image-reference" href="../../_images/CometPEARC17-cm-virtualbox-001.png"><img alt="screenshot" src="../../_images/CometPEARC17-cm-virtualbox-001.png" style="width: 712.0px; height: 360.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Locate downloaded VirtualBox Appliance file (CometPEARC17.ova)</span></p>
</div>
</div>
<div class="section" id="step-3-import-comet-pearc17-virtualbox-appliance">
<h4><a class="toc-backref" href="#id31">Step 3: Import Comet PEARC17 VirtualBox Appliance</a><a class="headerlink" href="#step-3-import-comet-pearc17-virtualbox-appliance" title="Permalink to this headline">Â¶</a></h4>
<p>During import of the Comet PEARC17 VirtualBox Appliance you will have the option
to configure the number of CPUs and amount of RAM. We recommend 2 CPUs and 2048
MB of RAM.</p>
<div class="figure" id="id6">
<a class="reference internal image-reference" href="../../_images/CometPEARC17-cm-virtualbox-002.png"><img alt="screenshot" src="../../_images/CometPEARC17-cm-virtualbox-002.png" style="width: 1280.0px; height: 760.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Configure processors and memory for VirutalBox Appliance</span></p>
</div>
<p>After youâve  configured the Comet PEARC17 VirtualBox Appliance click on the
<strong>Import</strong> button to initiate the import processâ¦</p>
<div class="figure" id="id7">
<a class="reference internal image-reference" href="../../_images/CometPEARC17-cm-virtualbox-003.png"><img alt="screenshot" src="../../_images/CometPEARC17-cm-virtualbox-003.png" style="width: 1280.0px; height: 760.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Import VirtualBox Appliance</span></p>
</div>
</div>
<div class="section" id="step-4-run-comet-pearc17-virtualbox-appliance">
<h4><a class="toc-backref" href="#id32">Step 4: Run Comet PEARC17 VirtualBox Appliance</a><a class="headerlink" href="#step-4-run-comet-pearc17-virtualbox-appliance" title="Permalink to this headline">Â¶</a></h4>
<p>After youâve successfully imported the Comet PEARC17 VirtualBox Appliance you
can select the machine and click on the <strong>Start</strong> button to start the machine.</p>
<div class="figure" id="id8">
<a class="reference internal image-reference" href="../../_images/CometPEARC17-cm-virtualbox-005.png"><img alt="screenshot" src="../../_images/CometPEARC17-cm-virtualbox-005.png" style="width: 1280.0px; height: 760.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Start VirtualBox Appliance</span></p>
</div>
</div>
<div class="section" id="step-5-open-terminal-in-comet-pearc17-virtualbox-appliance">
<h4><a class="toc-backref" href="#id33">Step 5: Open Terminal in Comet PEARC17 VirtualBox Appliance</a><a class="headerlink" href="#step-5-open-terminal-in-comet-pearc17-virtualbox-appliance" title="Permalink to this headline">Â¶</a></h4>
<p>After the Comet PEARC17 VirtualBox machine has booted you can open a terminal
and start using Cloudmesh Client as it is pre-installed.</p>
<div class="figure" id="id9">
<a class="reference internal image-reference" href="../../_images/CometPEARC17-cm-virtualbox-007.png"><img alt="screenshot" src="../../_images/CometPEARC17-cm-virtualbox-007.png" style="width: 1280.0px; height: 760.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Open Terminal in Ubuntu Desktop</span></p>
</div>
<div class="figure" id="id10">
<a class="reference internal image-reference" href="../../_images/CometPEARC17-cm-virtualbox-008.png"><img alt="screenshot" src="../../_images/CometPEARC17-cm-virtualbox-008.png" style="width: 1280.0px; height: 760.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Run Cloudmesh Client in Terminal</span></p>
</div>
</div>
</div>
<div class="section" id="cloudmesh-client-tool-in-empty-virtual-box-machine">
<h3><a class="toc-backref" href="#id34">Cloudmesh Client tool in empty Virtual Box Machine</a><a class="headerlink" href="#cloudmesh-client-tool-in-empty-virtual-box-machine" title="Permalink to this headline">Â¶</a></h3>
<div class="section" id="id1">
<h4><a class="toc-backref" href="#id35">Step 1: Install Virtual Box</a><a class="headerlink" href="#id1" title="Permalink to this headline">Â¶</a></h4>
<p>For convenience we will be using Ubuntu Xenial in this demo to
install the Cloudmesh client on it. Please make sure you have</p>
<ul class="simple">
<li><a class="reference external" href="https://www.virtualbox.org">VirtualBox</a> installed (<a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">downloads page</a>).</li>
</ul>
</div>
<div class="section" id="step-2-download-a-virtualbox-image">
<h4><a class="toc-backref" href="#id36">Step 2: Download a VirtualBox Image</a><a class="headerlink" href="#step-2-download-a-virtualbox-image" title="Permalink to this headline">Â¶</a></h4>
<p>Next, please download the</p>
<ul class="simple">
<li><a class="reference external" href="http://www.ubuntu.com/download">Ubuntu desktop ISO</a>.</li>
</ul>
<p>and remember the location where you downloaded it. You will need that
location later.</p>
</div>
<div class="section" id="step-3-create-a-virtualbox-machine">
<h4><a class="toc-backref" href="#id37">Step 3: Create a VirtualBox Machine</a><a class="headerlink" href="#step-3-create-a-virtualbox-machine" title="Permalink to this headline">Â¶</a></h4>
<p>Create VirtualBox Machine, create a new VM (Ubuntu, 64bit)</p>
</div>
<div class="section" id="step-4-associate-the-vm-iso">
<h4><a class="toc-backref" href="#id38">Step 4: Associate the VM ISO</a><a class="headerlink" href="#step-4-associate-the-vm-iso" title="Permalink to this headline">Â¶</a></h4>
<p>When asked for the ISO, use the folder icon to browse to the location of the
downloaded image.</p>
</div>
<div class="section" id="step-5-start-the-vm">
<h4><a class="toc-backref" href="#id39">Step 5: Start the vm</a><a class="headerlink" href="#step-5-start-the-vm" title="Permalink to this headline">Â¶</a></h4>
<p>Start and configure the system. Note in case the last step does not return, shut
down or terminate the VM and restart it.</p>
</div>
<div class="section" id="step-6-start-a-terminal">
<h4><a class="toc-backref" href="#id40">Step 6: Start a terminal</a><a class="headerlink" href="#step-6-start-a-terminal" title="Permalink to this headline">Â¶</a></h4>
<p>Once you have logged into the vm, start a terminal by clicking on the cog and
type in <strong>terminal</strong>.</p>
</div>
<div class="section" id="step-7-vm-guest-additions">
<h4><a class="toc-backref" href="#id41">Step 7: VM guest additions</a><a class="headerlink" href="#step-7-vm-guest-additions" title="Permalink to this headline">Â¶</a></h4>
<p>(optional) You may want to enable the vm guest addition and enable
bidirectional shared clipboard and drag and drop. You may have to
restart the vm so that these changes take effect.</p>
</div>
<div class="section" id="step-8-install-cloudmesh">
<h4><a class="toc-backref" href="#id42">Step 8: Install cloudmesh</a><a class="headerlink" href="#step-8-install-cloudmesh" title="Permalink to this headline">Â¶</a></h4>
<pre class="highlight"><style type="text/css">
span.prompt1:before {
  content: "cloudmesh$ ";
}
</style><span class="prompt1">wget -O cm-setup.sh http://bit.ly/cloudmesh-client-xenial</span>
<span class="prompt1">sh cm-setup.sh</span>
</pre><p>The script has the following contents:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sudo apt install python-pip -y
sudo apt install libssl-dev -y
sudo pip install pip -U
sudo apt install git -y
sudo pip install ansible
sudo pip install cloudmesh_client
python --version
pip --version
git âversion
</pre></div>
</div>
<p>Make sure passlib is installed:</p>
<pre class="highlight"><span class="prompt1">sudo pip install passlib</span>
</pre></div>
</div>
<div class="section" id="cloudmesh-client-tool-installed-directly-in-macos">
<h3><a class="toc-backref" href="#id43">Cloudmesh Client Tool Installed Directly in MacOS</a><a class="headerlink" href="#cloudmesh-client-tool-installed-directly-in-macos" title="Permalink to this headline">Â¶</a></h3>
<p>For system level packages installation, see: <a class="reference external" href="http://cloudmesh.github.io/client/system.html#osx">http://cloudmesh.github.io/client/system.html#osx</a></p>
<p>For the Cloudmesh client tool installation:</p>
<pre class="highlight"><style type="text/css">
span.prompt2:before {
  content: "$ ";
}
</style><span class="prompt2">virtualenv ~/CM</span>
<span class="prompt2">source ~/CM/bin/activate</span>
</pre><pre class="highlight"><style type="text/css">
span.prompt3:before {
  content: "(CM)$ ";
}
</style><span class="prompt3">pip install -U pip</span>
<span class="prompt3">pip install cloudmesh_client</span>
<span class="prompt3">pip install passlib</span>
</pre></div>
<div class="section" id="cloudmesh-client-tool-installed-directly-in-linux">
<h3><a class="toc-backref" href="#id44">Cloudmesh Client Tool Installed Directly in Linux</a><a class="headerlink" href="#cloudmesh-client-tool-installed-directly-in-linux" title="Permalink to this headline">Â¶</a></h3>
<p>For system level packages installation, see: <a class="reference external" href="http://cloudmesh.github.io/client/system.html#ubuntu-16-04">http://cloudmesh.github.io/client/system.html#ubuntu-16-04</a></p>
<p>For the Cloudmesh client tool installation:</p>
<pre class="highlight"><span class="prompt2">virtualenv ~/CM</span>
<span class="prompt2">source ~/CM/bin/activate</span>
</pre><pre class="highlight"><span class="prompt3">pip install -U pip</span>
<span class="prompt3">pip install cloudmesh_client</span>
<span class="prompt3">pip install passlib</span>
</pre></div>
</div>
<div class="section" id="using-cloudmesh-client-tool-to-access-comet-vc">
<h2><a class="toc-backref" href="#id45">Using Cloudmesh Client tool to access Comet VC</a><a class="headerlink" href="#using-cloudmesh-client-tool-to-access-comet-vc" title="Permalink to this headline">Â¶</a></h2>
<p>To verify the Cloudmesh client tool has been installed properly, try:</p>
<pre class="highlight"><span class="prompt3">cms verion</span>
<span class="prompt3">cms help</span>
</pre><p>And to initialize the comet authentication settings:</p>
<pre class="highlight"><span class="prompt3">cms comet init</span>
</pre><p>Use all default settings, and provide your Comet VC username/password
to retrieve an API key:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>Initializing the comet configuration file...
Set the active service endpoint to use. The availalbe endpoints are - dev/production [dev]:
Set the base url for the nucleus dev service [https://comet-nucleus-dev.sdsc.edu/nucleus]:
Set the api version for the nucleus dev service [v1]:
Authenticating to the nucleus dev service and obtaining the apikey...
Comet nucleus username [YOUR_COMET_VC_USER]:
Password:
api key retrieval and set was successful!
</pre></div>
</div>
</div>
<div class="section" id="virtual-cluster-architecture">
<h2><a class="toc-backref" href="#id46">Virtual Cluster Architecture</a><a class="headerlink" href="#virtual-cluster-architecture" title="Permalink to this headline">Â¶</a></h2>
<div class="figure" id="id11">
<a class="reference internal image-reference" href="../../_images/vc-diagram_pearc17.png"><img alt="screenshot" src="../../_images/vc-diagram_pearc17.png" style="width: 628.0px; height: 411.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: Virtual cluster architecture</span></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We used name <cite>vctNN</cite> in this tutorial as an example VC name.
please replace this with the proper name assigned to you.</p>
</div>
</div>
<div class="section" id="getting-access-to-your-cluster">
<h2><a class="toc-backref" href="#id47">Getting access to your cluster</a><a class="headerlink" href="#getting-access-to-your-cluster" title="Permalink to this headline">Â¶</a></h2>
<p>The cluster information can be obtained with the following commands:</p>
<pre class="highlight"><span class="prompt3">cms comet ll</span>
<span class="prompt3">cms comet cluster</span>
<span class="prompt3">cms comet cluster vctNN</span>
</pre><p>The list of ISO images that are currently available can be obtained with:</p>
<pre class="highlight"><span class="prompt3">cms comet iso list</span>
</pre></div>
<div class="section" id="install-the-vc-front-end-node">
<h2><a class="toc-backref" href="#id48">Install the VC front-end node</a><a class="headerlink" href="#install-the-vc-front-end-node" title="Permalink to this headline">Â¶</a></h2>
<p><strong>NOTE: During the PEARC17 Tutorial the initial install of the cluster frontend
**has been completed in advance. The following steps are included to document
**the process  that was followed.</strong></p>
<p>This section takes ~10 min to finish.</p>
<p>Find an iso and attach</p>
<pre class="highlight"><span class="prompt3">cms comet iso list</span>
</pre><p>This will return:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">:</span> <span class="n">CentOS</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">NetInstall</span><span class="o">-</span><span class="mf">1511.</span><span class="n">iso</span>
<span class="mi">2</span><span class="p">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">amd64</span><span class="o">.</span><span class="n">iso</span>
<span class="mi">3</span><span class="p">:</span> <span class="n">ipxe</span><span class="o">.</span><span class="n">iso</span>
<span class="o">...&lt;</span><span class="n">snip</span><span class="o">&gt;...</span>
<span class="mi">19</span><span class="p">:</span> <span class="n">Fedora</span><span class="o">-</span><span class="n">Server</span><span class="o">-</span><span class="n">netinst</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mi">25</span><span class="o">-</span><span class="mf">1.3</span><span class="o">.</span><span class="n">iso</span>
<span class="mi">20</span><span class="p">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">14.04</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">amd64</span><span class="o">.</span><span class="n">iso</span>
</pre></div>
</div>
<p>Next we attach an iso. You can use either the name of the iso, or simply the id</p>
<pre class="highlight"><span class="prompt3">cms comet iso attach 2 vctNN</span>
</pre><p>Please note for this tutorial we use image 2, the latest Ubuntu 16.04.2.</p>
<p>Let us check the status of the server.</p>
<pre class="highlight"><span class="prompt3">cms comet cluster vctNN</span>
</pre><p>If it is already running, please power if off so the iso attach could
take effect:</p>
<pre class="highlight"><span class="prompt3">cms comet power off vctNN</span>
</pre><p>Now we need to power on the server</p>
<pre class="highlight"><span class="prompt3">cms comet power on vctNN</span>
</pre><p>To see what is happening on the server and finish the installation,
we need to attach a console to follow the installation steps:</p>
<pre class="highlight"><span class="prompt3">cms comet console vctNN</span>
</pre><p>Screenshots for the front-end node configuration are given next:</p>
<div class="figure" id="id12">
<a class="reference internal image-reference" href="../../_images/00_install_language.png"><img alt="screenshot" src="../../_images/00_install_language.png" style="width: 1271.5px; height: 767.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: Initial screen after Front-end (FE) booted</span></p>
</div>
<div class="figure" id="id13">
<a class="reference internal image-reference" href="../../_images/00_install_start.png"><img alt="screenshot" src="../../_images/00_install_start.png" style="width: 643.5px; height: 485.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: Install ubuntu server</span></p>
</div>
<div class="figure" id="id14">
<a class="reference internal image-reference" href="../../_images/01_NIC.png"><img alt="screenshot" src="../../_images/01_NIC.png" style="width: 803.5px; height: 604.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Configure the network. DHCP is configured on <cite>ens4</cite> (the public interface)</span></p>
</div>
<div class="figure" id="id15">
<a class="reference internal image-reference" href="../../_images/20_hostname.png"><img alt="screenshot" src="../../_images/20_hostname.png" style="width: 803.5px; height: 604.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: The hostname should be automatically set to the one assigned to you</span></p>
</div>
<div class="figure" id="id16">
<a class="reference internal image-reference" href="../../_images/09_services_packages.png"><img alt="screenshot" src="../../_images/09_services_packages.png" style="width: 802.5px; height: 606.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: Select OpenSSH using the arrow keys and space bar and then tab to Continue</span></p>
</div>
<div class="figure" id="id17">
<a class="reference internal image-reference" href="../../_images/10_complete.png"><img alt="screenshot" src="../../_images/10_complete.png" style="width: 803.0px; height: 604.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Complete the installation</span></p>
</div>
<p>Now the node will reboot. Watch carefully to find this screen, and then
press âESCâ key.</p>
<div class="figure" id="id18">
<a class="reference internal image-reference" href="../../_images/11_reboot_esc.png"><img alt="screenshot" src="../../_images/11_reboot_esc.png" style="width: 722.5px; height: 402.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Booting menu after installation</span></p>
</div>
<p>Then choose the 3rd device - virtio disk</p>
<div class="figure" id="id19">
<a class="reference internal image-reference" href="../../_images/12_boot_3_virtio.png"><img alt="screenshot" src="../../_images/12_boot_3_virtio.png" style="width: 723.5px; height: 404.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: Choose to boot from the disk</span></p>
</div>
<p>In case you missed the <code class="code docutils literal"><span class="pre">ESC+F12</span></code> step, the node will be booted to the CD again.
Simply reboot the machine using <code class="code docutils literal"><span class="pre">CTRL+ALT+DEL</span></code> to start again. Now choose âBoot
from first hard diskâ, and carefully watch till it failed</p>
<div class="figure" id="id20">
<a class="reference internal image-reference" href="../../_images/30_reboot_choose_hd.png"><img alt="screenshot" src="../../_images/30_reboot_choose_hd.png" style="width: 643.5px; height: 484.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: From the CDROM boot menu, choose to boot from hard disk</span></p>
</div>
<div class="figure" id="id21">
<a class="reference internal image-reference" href="../../_images/31_boot_hd_fail.png"><img alt="screenshot" src="../../_images/31_boot_hd_fail.png" style="width: 725.5px; height: 404.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: Boot from HD from the CDROM boot menu will fail, press any key to reboot again</span></p>
</div>
<p>Then press any key so it reboot again, and try to catch the <code class="code docutils literal"><span class="pre">ESC+F12</span></code> screen again.</p>
<div class="figure" id="id22">
<a class="reference internal image-reference" href="../../_images/13_booted_login.png"><img alt="screenshot" src="../../_images/13_booted_login.png" style="width: 1272.5px; height: 747.5px;" /></a>
<p class="caption"><span class="caption-text">Figure: Login screen after boot</span></p>
</div>
</div>
<div class="section" id="configuring-the-front-end-node">
<h2><a class="toc-backref" href="#id49">Configuring the front-end node</a><a class="headerlink" href="#configuring-the-front-end-node" title="Permalink to this headline">Â¶</a></h2>
<p>This section takes ~5 min to finish.</p>
<p>Now the FE node is back on, you can login and configure the cluster from your laptop/desktop.</p>
<p>To verify, you can try ssh login first. Use the uesrname and password you set
during the FE node installation.</p>
<pre class="highlight"><span class="prompt3">ssh USER@vctNN.sdsc.edu</span>
</pre><p>Once the ssh login is verified, we can start the configuration of the FE node.
We have scripted this process to only a few steps:</p>
<p>On your <strong>managing machine</strong> where Cloudmesh client tools is installed
(make sure virtualenv is activated if you have used that):</p>
<pre class="highlight"><span class="prompt3">mkdir ~/pearc17</span>
<span class="prompt3">cd ~/pearc17</span>
<span class="prompt3">git clone https://github.com/cloudmesh/cloudmesh.comet.vcdeploy.git</span>
<span class="prompt3">cd cloudmesh.comet.vcdeploy/ubuntu16.04.2</span>
<span class="prompt3">./deploy.sh &lt;vctNN&gt; &lt;USER&gt;</span>
</pre><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may be asked to provide the password for several times.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Itâs assumed that you have had a ssh keypair in ~/.ssh/. If you
havenât had one, use ssh-keygen to generate a keypair first.</p>
</div>
<p>This will finish the configuration. At the end you will see something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">PLAY</span> <span class="n">RECAP</span> <span class="o">**************************************************************</span>
<span class="n">vctNN</span><span class="o">.</span><span class="n">sdsc</span><span class="o">.</span><span class="n">edu</span>             <span class="p">:</span> <span class="n">ok</span><span class="o">=</span><span class="mi">48</span>   <span class="n">changed</span><span class="o">=</span><span class="mi">41</span>   <span class="n">unreachable</span><span class="o">=</span><span class="mi">0</span>    <span class="n">failed</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Which indicates the process has been completed successfully.</p>
<p>At this point we are done with the ISO so you could detach it:</p>
<pre class="highlight"><span class="prompt3">cms comet iso detach vctNN</span>
</pre><p>ISO are removed the next time the virtual node is shutdown or powered
off (not when rebooted or reset). If the ISO stays attached, rebooting
the FE node will boot to the CDROM boot menu again, and you will need
to attach to console access to choose the boot options.</p>
</div>
<div class="section" id="install-vc-compute-nodes">
<h2><a class="toc-backref" href="#id50">Install VC Compute Nodes</a><a class="headerlink" href="#install-vc-compute-nodes" title="Permalink to this headline">Â¶</a></h2>
<p>This section takes ~5 to 10 min to complete.</p>
<p>On your <strong>managing machine</strong> where Cloudmesh client tools is installed
(make sure virtualenv is activated if you have used that):</p>
<pre class="highlight"><span class="prompt3">cms comet start vctNN vm-vctNN-[00-01]</span>
</pre><p>This starts the compute nodes. Once the resources are allocated and the
nodes are booted, they will be net-installed automatically.</p>
<p>You can check the status of the nodes by running:</p>
<pre class="highlight"><span class="prompt3">cms comet cluster vctNN --status</span>
</pre><div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Cluster</span><span class="p">:</span> <span class="n">vctNN</span>      <span class="n">Frontend</span><span class="p">:</span> <span class="n">vctNN</span> <span class="n">IP</span><span class="p">:</span> <span class="mf">132.249</span><span class="o">.</span><span class="n">xxx</span><span class="o">.</span><span class="n">xxx</span>
<span class="o">+-------------+--------+------------+------------+-------------+</span>
<span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="n">state</span>  <span class="o">|</span> <span class="n">computeset</span> <span class="o">|</span> <span class="n">allocation</span> <span class="o">|</span> <span class="n">admin_state</span> <span class="o">|</span>
<span class="o">+-------------+--------+------------+------------+-------------+</span>
<span class="o">|</span> <span class="n">vctNN</span>       <span class="o">|</span> <span class="n">active</span> <span class="o">|</span>            <span class="o">|</span>            <span class="o">|</span> <span class="n">synced</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">vm</span><span class="o">-</span><span class="n">vctNN</span><span class="o">-</span><span class="mi">00</span> <span class="o">|</span> <span class="n">active</span> <span class="o">|</span> <span class="mi">26</span>         <span class="o">|</span> <span class="n">ABC123</span>     <span class="o">|</span> <span class="n">syncing</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">vm</span><span class="o">-</span><span class="n">vctNN</span><span class="o">-</span><span class="mi">01</span> <span class="o">|</span> <span class="n">active</span> <span class="o">|</span> <span class="mi">26</span>         <span class="o">|</span> <span class="n">ABC123</span>     <span class="o">|</span> <span class="n">syncing</span>     <span class="o">|</span>
<span class="o">+-------------+--------+------------+------------+-------------+</span>
</pre></div>
</div>
<p>At the end of the nodes installation the nodes will be powered off. Verify
this by running the previous command, and check if the <cite>state</cite> is not
<cite>active</cite>, and if the <cite>admin_state</cite> is <cite>ready</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The state update may have some delay, e.g., half a minute or so.
The <cite>active</cite> of <cite>state</cite> means the node is running; <cite>nostate</cite> or
sometimes <cite>nostate-error</cite> means the node is powered off. For
<cite>admin_state</cite>, <cite>synced</cite> means the node is running and the disk
is synced; <cite>syncing</cite> means the disk is syncing to the backend,
in which a power change of the node will be ignored; <cite>ready</cite>
means the node is off and the disk is ready to be booted.</p>
</div>
<p><strong>BEFORE</strong> powering them back on, you need to execute this from
the <strong>FE</strong> node:</p>
<p>Login to the FE node if not yet:</p>
<pre class="highlight"><span class="prompt3">ssh USER@vctNN.sdsc.edu</span>
</pre><p>Now from the <strong>FE</strong> node:</p>
<pre class="highlight"><style type="text/css">
span.prompt4:before {
  content: "FE$ ";
}
</style><span class="prompt4">sudo python cmutil.py setboot vctNN vm-vctNN-00 net=false</span>
<span class="prompt4">sudo python cmutil.py setboot vctNN vm-vctNN-01 net=false</span>
</pre><p>Otherwise the nodes will be net-installed again.</p>
<p>After disabled the netboot for the compute nodes, now on your <strong>managing host</strong>
where Cloudmesh client is installed:</p>
<pre class="highlight"><span class="prompt3">cms comet power on vctNN vm-vctNN-[00-01]</span>
</pre><p>Wait for the compute nodes to be booted on (This could take a few
minutes), which can be checked by:</p>
<pre class="highlight"><span class="prompt3">cms comet cluster vctNN --status</span>
</pre><p>to see if the state (2nd column) of the nodes is âactiveâ.</p>
<p>Once the compute nodes are on, run these on the <strong>FE</strong> node:</p>
<pre class="highlight"><span class="prompt4">python cmutil.py settrust vctNN</span>
</pre><p>This will propagate the ssh keys, known hosts file from the FE node to the
compute nodes, so ssh between any nodes within the VC could be easily done.</p>
<p>Login to compute nodes from front-end, and run your app.</p>
</div>
<div class="section" id="demo1-verifying-infiniband-performance">
<h2><a class="toc-backref" href="#id51">DEMO1: Verifying InfiniBand Performance</a><a class="headerlink" href="#demo1-verifying-infiniband-performance" title="Permalink to this headline">Â¶</a></h2>
<p>Weâll start by verifying the InfiniBand connectivity between the
compute nodes using RDMA performance tests and the <a class="reference external" href="http://mvapich.cse.ohio-state.edu/benchmarks/">OSU
Micro-Benchmarks</a>. The InfiniBand tests
are in the Ubuntu <code class="docutils literal"><span class="pre">perftest</span></code> package which is already installed on the
compute nodes. The InfiniBand tests must run as <code class="docutils literal"><span class="pre">root</span></code> so weâll
change to <code class="docutils literal"><span class="pre">root</span></code> on the front-end and then use the SSH keys that are
in place to access the compute nodes.</p>
<p>From your <strong>managing machine</strong> open two SSH terminals to your virtual
front-end. And then from the <strong>FE</strong> terminals:</p>
<p>In one terminal, start a server on the first compute node:</p>
<pre class="highlight"><span class="prompt4">ssh vm-vctNN-00</span>
</pre><p>Then in that vm type</p>
<pre class="highlight"><style type="text/css">
span.prompt5:before {
  content: "vm-vctNN-00$ ";
}
</style><span class="prompt5">ib_write_bw</span>
</pre><p>In the other terminal, connect to the server from the second compute
node and start the test:</p>
<pre class="highlight"><span class="prompt4">ssh vm-vctNN-01</span>
</pre><pre class="highlight"><style type="text/css">
span.prompt6:before {
  content: "vm-vctNN-01$ ";
}
</style><span class="prompt6">ib_write_bw vm-vctNN-00</span>
</pre><p>The bandwidth results will confirm that weâre sending data over InfiniBand:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------------------</span>
                    <span class="n">RDMA_Write</span> <span class="n">BW</span> <span class="n">Test</span>
 <span class="n">Dual</span><span class="o">-</span><span class="n">port</span>       <span class="p">:</span> <span class="n">OFF</span>              <span class="n">Device</span>         <span class="p">:</span> <span class="n">mlx4_0</span>
 <span class="n">Number</span> <span class="n">of</span> <span class="n">qps</span>   <span class="p">:</span> <span class="mi">1</span>                <span class="n">Transport</span> <span class="nb">type</span> <span class="p">:</span> <span class="n">IB</span>
 <span class="n">Connection</span> <span class="nb">type</span> <span class="p">:</span> <span class="n">RC</span>               <span class="n">Using</span> <span class="n">SRQ</span>      <span class="p">:</span> <span class="n">OFF</span>
 <span class="n">TX</span> <span class="n">depth</span>        <span class="p">:</span> <span class="mi">128</span>
 <span class="n">CQ</span> <span class="n">Moderation</span>   <span class="p">:</span> <span class="mi">100</span>
 <span class="n">Mtu</span>             <span class="p">:</span> <span class="mi">2048</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
 <span class="n">Link</span> <span class="nb">type</span>       <span class="p">:</span> <span class="n">IB</span>
 <span class="n">Max</span> <span class="n">inline</span> <span class="n">data</span> <span class="p">:</span> <span class="mi">0</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
 <span class="n">rdma_cm</span> <span class="n">QPs</span>         <span class="p">:</span> <span class="n">OFF</span>
 <span class="n">Data</span> <span class="n">ex</span><span class="o">.</span> <span class="n">method</span> <span class="p">:</span> <span class="n">Ethernet</span>
<span class="o">---------------------------------------------------------------------------------------</span>
 <span class="n">local</span> <span class="n">address</span><span class="p">:</span> <span class="n">LID</span> <span class="mh">0x3c</span> <span class="n">QPN</span> <span class="mh">0x0a1b</span> <span class="n">PSN</span> <span class="mh">0xecf3ce</span> <span class="n">RKey</span> <span class="mh">0x68010f00</span> <span class="n">VAddr</span> <span class="mh">0x002b19db6f2000</span>
 <span class="n">remote</span> <span class="n">address</span><span class="p">:</span> <span class="n">LID</span> <span class="mh">0x11</span> <span class="n">QPN</span> <span class="mh">0x0a1b</span> <span class="n">PSN</span> <span class="mh">0x3e7b9f</span> <span class="n">RKey</span> <span class="mh">0x68010f00</span> <span class="n">VAddr</span> <span class="mh">0x002b41b62fd000</span>
<span class="o">---------------------------------------------------------------------------------------</span>
 <span class="c1">#bytes     #iterations    BW peak[MB/sec]    BW average[MB/sec]   MsgRate[Mpps]</span>
 <span class="mi">65536</span>      <span class="mi">5000</span>             <span class="mf">6034.72</span>            <span class="mf">6033.76</span>                <span class="mf">0.096540</span>
<span class="o">---------------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>And the first server will show its results in the first terminal:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">************************************</span>
<span class="o">*</span> <span class="n">Waiting</span> <span class="k">for</span> <span class="n">client</span> <span class="n">to</span> <span class="n">connect</span><span class="o">...</span> <span class="o">*</span>
<span class="o">************************************</span>
<span class="o">---------------------------------------------------------------------------------------</span>
                    <span class="n">RDMA_Write</span> <span class="n">BW</span> <span class="n">Test</span>
 <span class="n">Dual</span><span class="o">-</span><span class="n">port</span>       <span class="p">:</span> <span class="n">OFF</span>              <span class="n">Device</span>         <span class="p">:</span> <span class="n">mlx4_0</span>
 <span class="n">Number</span> <span class="n">of</span> <span class="n">qps</span>   <span class="p">:</span> <span class="mi">1</span>                <span class="n">Transport</span> <span class="nb">type</span> <span class="p">:</span> <span class="n">IB</span>
 <span class="n">Connection</span> <span class="nb">type</span> <span class="p">:</span> <span class="n">RC</span>               <span class="n">Using</span> <span class="n">SRQ</span>      <span class="p">:</span> <span class="n">OFF</span>
 <span class="n">CQ</span> <span class="n">Moderation</span>   <span class="p">:</span> <span class="mi">100</span>
 <span class="n">Mtu</span>             <span class="p">:</span> <span class="mi">2048</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
 <span class="n">Link</span> <span class="nb">type</span>       <span class="p">:</span> <span class="n">IB</span>
 <span class="n">Max</span> <span class="n">inline</span> <span class="n">data</span> <span class="p">:</span> <span class="mi">0</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
 <span class="n">rdma_cm</span> <span class="n">QPs</span>         <span class="p">:</span> <span class="n">OFF</span>
 <span class="n">Data</span> <span class="n">ex</span><span class="o">.</span> <span class="n">method</span> <span class="p">:</span> <span class="n">Ethernet</span>
<span class="o">---------------------------------------------------------------------------------------</span>
 <span class="n">local</span> <span class="n">address</span><span class="p">:</span> <span class="n">LID</span> <span class="mh">0x11</span> <span class="n">QPN</span> <span class="mh">0x0a1b</span> <span class="n">PSN</span> <span class="mh">0x3e7b9f</span> <span class="n">RKey</span> <span class="mh">0x68010f00</span> <span class="n">VAddr</span> <span class="mh">0x002b41b62fd000</span>
 <span class="n">remote</span> <span class="n">address</span><span class="p">:</span> <span class="n">LID</span> <span class="mh">0x3c</span> <span class="n">QPN</span> <span class="mh">0x0a1b</span> <span class="n">PSN</span> <span class="mh">0xecf3ce</span> <span class="n">RKey</span> <span class="mh">0x68010f00</span> <span class="n">VAddr</span> <span class="mh">0x002b19db6f2000</span>
<span class="o">---------------------------------------------------------------------------------------</span>
 <span class="c1">#bytes     #iterations    BW peak[MB/sec]    BW average[MB/sec]   MsgRate[Mpps]</span>
 <span class="mi">65536</span>      <span class="mi">5000</span>             <span class="mf">6034.72</span>            <span class="mf">6033.76</span>                <span class="mf">0.096540</span>
<span class="o">---------------------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>Similarly, we can test the latency by running <code class="code docutils literal"><span class="pre">ib_write_lat</span></code> in the
place of <code class="code docutils literal"><span class="pre">ib_write_bw</span></code>. The results are as such. Please note we added
option <code class="code docutils literal"><span class="pre">-a</span></code> to run the test with different run sizes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">---------------------------------------------------------------------------------------</span>
 <span class="c1">#bytes #iterations    t_min[usec]    t_max[usec]  t_typical[usec]</span>
 <span class="mi">2</span>       <span class="mi">1000</span>          <span class="mf">1.10</span>           <span class="mf">5.29</span>         <span class="mf">1.13</span>
 <span class="mi">4</span>       <span class="mi">1000</span>          <span class="mf">1.10</span>           <span class="mf">2.30</span>         <span class="mf">1.13</span>
 <span class="mi">8</span>       <span class="mi">1000</span>          <span class="mf">1.11</span>           <span class="mf">8.23</span>         <span class="mf">1.14</span>
 <span class="mi">16</span>      <span class="mi">1000</span>          <span class="mf">1.11</span>           <span class="mf">6.27</span>         <span class="mf">1.14</span>
 <span class="mi">32</span>      <span class="mi">1000</span>          <span class="mf">1.15</span>           <span class="mf">6.38</span>         <span class="mf">1.18</span>
 <span class="mi">64</span>      <span class="mi">1000</span>          <span class="mf">1.17</span>           <span class="mf">2.88</span>         <span class="mf">1.20</span>
 <span class="mi">128</span>     <span class="mi">1000</span>          <span class="mf">1.27</span>           <span class="mf">7.02</span>         <span class="mf">1.29</span>
 <span class="mi">256</span>     <span class="mi">1000</span>          <span class="mf">1.60</span>           <span class="mf">7.88</span>         <span class="mf">1.63</span>
 <span class="mi">512</span>     <span class="mi">1000</span>          <span class="mf">1.81</span>           <span class="mf">7.82</span>         <span class="mf">1.85</span>
 <span class="mi">1024</span>    <span class="mi">1000</span>          <span class="mf">2.04</span>           <span class="mf">7.45</span>         <span class="mf">2.08</span>
 <span class="mi">2048</span>    <span class="mi">1000</span>          <span class="mf">2.52</span>           <span class="mf">7.04</span>         <span class="mf">2.58</span>
 <span class="mi">4096</span>    <span class="mi">1000</span>          <span class="mf">2.85</span>           <span class="mf">6.62</span>         <span class="mf">2.91</span>
 <span class="mi">8192</span>    <span class="mi">1000</span>          <span class="mf">3.49</span>           <span class="mf">7.60</span>         <span class="mf">3.56</span>
 <span class="mi">16384</span>   <span class="mi">1000</span>          <span class="mf">4.74</span>           <span class="mf">7.46</span>         <span class="mf">4.98</span>
 <span class="mi">32768</span>   <span class="mi">1000</span>          <span class="mf">7.44</span>           <span class="mf">11.96</span>        <span class="mf">7.58</span>
 <span class="mi">65536</span>   <span class="mi">1000</span>          <span class="mf">12.71</span>          <span class="mf">36.10</span>        <span class="mf">12.91</span>
 <span class="mi">131072</span>  <span class="mi">1000</span>          <span class="mf">22.94</span>          <span class="mf">28.73</span>        <span class="mf">23.38</span>
 <span class="mi">262144</span>  <span class="mi">1000</span>          <span class="mf">43.66</span>          <span class="mf">46.34</span>        <span class="mf">44.16</span>
 <span class="mi">524288</span>  <span class="mi">1000</span>          <span class="mf">84.88</span>          <span class="mf">88.37</span>        <span class="mf">85.68</span>
 <span class="mi">1048576</span> <span class="mi">1000</span>          <span class="mf">167.85</span>         <span class="mf">173.88</span>       <span class="mf">169.49</span>
 <span class="mi">2097152</span> <span class="mi">1000</span>          <span class="mf">333.30</span>         <span class="mf">343.71</span>       <span class="mf">335.02</span>
 <span class="mi">4194304</span> <span class="mi">1000</span>          <span class="mf">665.24</span>         <span class="mf">683.21</span>       <span class="mf">668.04</span>
 <span class="mi">8388608</span> <span class="mi">1000</span>          <span class="mf">1442.65</span>        <span class="mf">1451.63</span>      <span class="mf">1447.71</span>
<span class="o">---------------------------------------------------------------------------------------</span>
</pre></div>
</div>
</div>
<div class="section" id="demo2-osu-micro-benchmarks">
<h2><a class="toc-backref" href="#id52">DEMO2: OSU Micro-Benchmarks</a><a class="headerlink" href="#demo2-osu-micro-benchmarks" title="Permalink to this headline">Â¶</a></h2>
<p>The <a class="reference external" href="http://mvapich.cse.ohio-state.edu/benchmarks/">OSU Micro-Benchmarks</a> are suite of
individual applications measuring the latency and bandwidth of
individual MPI calls. The cover both the performance of both the
underlying network fabric and the MPI implementation. The
Micro-Benchmarks provide coverage for the latest MPI standards but the
version of <a class="reference external" href="https://www.open-mpi.org/">Open MPI</a> in the Ubuntu
Trusty distribution is a bit older and not all of the messaging calls
are available. Weâll focus only a few as part of the InfiniBand and
MPI verification.</p>
<p>Begin by logging on to the first compute node where weâll download and
compile the benchmarks. This can be done with your non-privileged user
account. Then download the benchmarks, extract, and configure the
source.</p>
<pre class="highlight"><span class="prompt4">ssh vm-vctNN-00</span>
</pre><pre class="highlight"><span class="prompt5">wget http://mvapich.cse.ohio-state.edu/download/mvapich/osu-micro-benchmarks-5.3.tar.gz</span>
<span class="prompt5">tar -zxf osu-micro-benchmarks-5.3.tar.gz</span>
<span class="prompt5">cd osu-micro-benchmarks-5.3/</span>
<span class="prompt5">./configure CC=/usr/bin/mpicc CXX=/usr/bin/mpicxx</span>
</pre><p>After the source configuration step completes, go into the directory
for the point-to-point communication benchmarks and compile them.</p>
<pre class="highlight"><span class="prompt5">cd mpi/pt2pt/</span>
<span class="prompt5">make</span>
</pre><p>To run the tests create a host file with the two compute nodes
specified:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vm</span><span class="o">-</span><span class="n">vctNN</span><span class="o">-</span><span class="mi">00</span>
<span class="n">vm</span><span class="o">-</span><span class="n">vctNN</span><span class="o">-</span><span class="mi">01</span>
</pre></div>
</div>
<p>Remember where youâve placed this (<code class="docutils literal"><span class="pre">$HOME/two-hosts.txt</span></code> is a good
idea) and run the bandwidth test.</p>
<pre class="highlight"><span class="prompt5">mpirun -np 2 -hostfile ~/two-hosts.txt ./osu_bw</span>
</pre><p>The results will go to the terminal and you can compare them to the
<code class="docutils literal"><span class="pre">ib_write_bw</span></code> performance. You can ignore Open MPIâs complaints
regarding registered memory, this is due to change in the driver:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># OSU MPI Bandwidth Test v5.3</span>
<span class="c1"># Size      Bandwidth (MB/s)</span>
<span class="mi">1</span>                       <span class="mf">9.04</span>
<span class="mi">2</span>                      <span class="mf">18.42</span>
<span class="mi">4</span>                      <span class="mf">37.70</span>
<span class="mi">8</span>                      <span class="mf">75.40</span>
<span class="mi">16</span>                    <span class="mf">146.69</span>
<span class="mi">32</span>                    <span class="mf">292.57</span>
<span class="mi">64</span>                    <span class="mf">428.43</span>
<span class="mi">128</span>                   <span class="mf">586.04</span>
<span class="mi">256</span>                   <span class="mf">909.23</span>
<span class="mi">512</span>                  <span class="mf">1595.34</span>
<span class="mi">1024</span>                 <span class="mf">3618.72</span>
<span class="mi">2048</span>                 <span class="mf">5236.77</span>
<span class="mi">4096</span>                 <span class="mf">6009.90</span>
<span class="mi">8192</span>                 <span class="mf">7854.50</span>
<span class="mi">16384</span>               <span class="mf">10265.02</span>
<span class="mi">32768</span>               <span class="mf">10829.96</span>
<span class="mi">65536</span>               <span class="mf">11345.41</span>
<span class="mi">131072</span>              <span class="mf">11442.63</span>
<span class="mi">262144</span>              <span class="mf">11430.55</span>
<span class="mi">524288</span>              <span class="mf">11322.77</span>
<span class="mi">1048576</span>             <span class="mf">10930.49</span>
<span class="mi">2097152</span>             <span class="mf">10711.41</span>
<span class="mi">4194304</span>             <span class="mf">10639.83</span>
</pre></div>
</div>
<p>Now weâll try a collective benchmark for <code class="docutils literal"><span class="pre">MPI_Alltoall</span></code>. We can
reuse our host file for 24 tasks and let MPI distribute the tasks.</p>
<pre class="highlight"><span class="prompt5">cd ../collective/</span>
<span class="prompt5">make osu_alltoall</span>
<span class="prompt5">mpirun -np 24 -hostfile ~/two-hosts.txt ./osu_alltoall</span>
</pre><p>Again, there perfomance results (this time for latency) go to the terminal:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># OSU MPI All-to-All Personalized Exchange Latency Test v5.3</span>
<span class="c1"># Size       Avg Latency(us)</span>
<span class="mi">1</span>                       <span class="mf">9.92</span>
<span class="mi">2</span>                      <span class="mf">10.31</span>
<span class="mi">4</span>                      <span class="mf">10.49</span>
<span class="mi">8</span>                      <span class="mf">10.60</span>
<span class="mi">16</span>                     <span class="mf">10.89</span>
<span class="mi">32</span>                     <span class="mf">11.34</span>
<span class="mi">64</span>                     <span class="mf">12.24</span>
<span class="mi">128</span>                    <span class="mf">15.14</span>
<span class="mi">256</span>                    <span class="mf">20.27</span>
<span class="mi">512</span>                    <span class="mf">37.53</span>
<span class="mi">1024</span>                   <span class="mf">29.62</span>
<span class="mi">2048</span>                   <span class="mf">53.92</span>
<span class="mi">4096</span>                  <span class="mf">119.42</span>
<span class="mi">8192</span>                  <span class="mf">192.33</span>
<span class="mi">16384</span>                 <span class="mf">314.22</span>
<span class="mi">32768</span>                 <span class="mf">557.86</span>
<span class="mi">65536</span>                <span class="mf">3082.00</span>
<span class="mi">131072</span>               <span class="mf">6302.07</span>
<span class="mi">262144</span>              <span class="mf">12704.54</span>
<span class="mi">524288</span>              <span class="mf">30272.60</span>
<span class="mi">1048576</span>             <span class="mf">50294.14</span>
</pre></div>
</div>
</div>
<div class="section" id="demo3-bigdata-analytical-software-stack-deployment-and-example-run">
<h2><a class="toc-backref" href="#id53">DEMO3: Bigdata analytical software stack deployment and example run</a><a class="headerlink" href="#demo3-bigdata-analytical-software-stack-deployment-and-example-run" title="Permalink to this headline">Â¶</a></h2>
<p>See <a class="reference internal" href="comet_bigdata.html#comet-bigdata"><span class="std std-ref">Comet Big Data Tutorial</span></a></p>
</div>
<div class="section" id="demo4-optional-openfoam">
<h2><a class="toc-backref" href="#id54">DEMO4 (optional): OpenFOAM</a><a class="headerlink" href="#demo4-optional-openfoam" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="http://openfoam.org/">OpenFOAM</a> is a parallel open-source
<a class="reference external" href="https://en.wikipedia.org/wiki/Computational_fluid_dynamics">computational fluid dynamics</a>
application that is available in a public Ubuntu repository. To
install it, on each of the compute nodes run:</p>
<pre class="highlight"><span class="prompt5">sudo apt install software-properties-common -y</span>
<span class="prompt5">sudo add-apt-repository http://download.openfoam.org/ubuntu</span>
<span class="prompt5">sudo apt-get update</span>
<span class="prompt5">sudo apt-get install openfoam4 -y --force-yes</span>
</pre><p>Add the OpenFOAM profile to your <code class="docutils literal"><span class="pre">.bashrc</span></code>:</p>
<pre class="highlight"><span class="prompt5">echo &#39;. /opt/openfoam4/etc/bashrc&#39; &gt;&gt; ~/.bashrc</span>
<span class="prompt5">source ~/.bashrc</span>
</pre><p>Weâre now able to setup the files and directories needed for a
benchmarking run.</p>
<pre class="highlight"><span class="prompt5">mkdir -p $FOAM_RUN</span>
<span class="prompt5">cd $FOAM_RUN</span>
<span class="prompt5">cp -r $FOAM_TUTORIALS/multiphase/interFoam/laminar/damBreak/damBreak .</span>
<span class="prompt5">foamCloneCase damBreak damBreakFine</span>
<span class="prompt5">cd damBreakFine</span>
<span class="prompt5">cp ~/comet-vc-tutorial/examples/OpenFOAM/blockMeshDict system/</span>
<span class="prompt5">cp ~/comet-vc-tutorial/examples/OpenFOAM/decomposeParDict system/</span>
</pre><p>Setup the mesh and initial conditions.</p>
<pre class="highlight"><span class="prompt5">blockMesh</span>
<span class="prompt5">cp -r 0/alpha.water.orig 0/alpha.water</span>
<span class="prompt5">setFields</span>
</pre><p>Decompose the mesh.</p>
<pre class="highlight"><span class="prompt5">decomposePar</span>
</pre><p>Create a host file (<code class="docutils literal"><span class="pre">hosts.txt</span></code>) and run the code. For example,
create <code class="docutils literal"><span class="pre">hosts.txt</span></code> for 24 tasks on each compute node and run.</p>
<pre class="highlight"><span class="prompt5">echo &quot;vm-vctNN-00 slots=24&quot; &gt; hosts.txt</span>
<span class="prompt5">echo &quot;vm-vctNN-01 slots=24&quot; &gt;&gt; hosts.txt</span>
<span class="prompt5">mpirun  -hostfile ./hosts.txt -np 48 `which foamExec` interFoam -parallel</span>
</pre><p>This will take a while (about 5-10 minutes).</p>
<p>The OpenFOAM packages include a version of <a class="reference external" href="http://www.paraview.org/">ParaView</a> for OpenFOAM that you can use to view the
mesh. From a system with X windows SSH to your front-end and compute
node with X forwarding enabled.</p>
<pre class="highlight"><span class="prompt5">ssh -X &lt;username&gt;@vctNN.sdsc.edu</span>
<span class="prompt5">ssh -X vm-vctNN-00</span>
<span class="prompt5">cd $FOAM_RUN/damBreakFine</span>
<span class="prompt5">paraFoam -case processor1</span>
</pre><div class="figure" id="id23">
<a class="reference internal image-reference" href="../../_images/paraview-vct.png"><img alt="screenshot" src="../../_images/paraview-vct.png" style="width: 972.0px; height: 685.0px;" /></a>
<p class="caption"><span class="caption-text">Figure: ParaView with OpenFOAM example data</span></p>
</div>
</div>
<div class="section" id="demo5-optional-julia">
<h2><a class="toc-backref" href="#id55">DEMO5 (optional): Julia</a><a class="headerlink" href="#demo5-optional-julia" title="Permalink to this headline">Â¶</a></h2>
<p><a class="reference external" href="http://julialang.org/">Julia</a> is a high-level, high-performance dynamic
programming language for numerical computing. It provides a sophisticated
compiler, distributed parallel execution, numerical accuracy, and an
extensive mathematical function library. Like OpenFOAM, Julia has Ubuntu
packages in public repositories. You can install on the compute nodes
following a similar process. On each compute node run the following
commands from <a class="reference external" href="http://julialang.org/downloads/platform.html">the Julia installation instructions for Ubuntu</a>. When prompted,
hit <code class="docutils literal"><span class="pre">ENTER</span></code>.</p>
<pre class="highlight"><span class="prompt5">sudo add-apt-repository ppa:staticfloat/juliareleases</span>
<span class="prompt5">sudo add-apt-repository ppa:staticfloat/julia-deps</span>
<span class="prompt5">sudo apt-get update</span>
<span class="prompt5">sudo apt-get install julia -y</span>
</pre><p>You can start Julia on the command line for interactive use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>rpwagner@vm-vctNN-00:~$ julia
               _
   _       _ _(_)_     |  A fresh approach to technical computing
  (_)     | (_) (_)    |  Documentation: http://docs.julialang.org
   _ _   _| |_  __ _   |  Type &quot;?help&quot; for help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 0.4.6 (2016-06-19 17:16 UTC)
 _/ |\__&#39;_|_|_|\__&#39;_|  |  Official http://julialang.org release
|__/                   |  x86_64-linux-gnu

julia&gt;
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>rpwagner@vm-vctNN-00:~$ julia --machinefile machinefile-jl.txt
               _
   _       _ _(_)_     |  A fresh approach to technical computing
  (_)     | (_) (_)    |  Documentation: http://docs.julialang.org
   _ _   _| |_  __ _   |  Type &quot;?help&quot; for help.
  | | | | | | |/ _` |  |
  | | |_| | | | (_| |  |  Version 0.4.6 (2016-06-19 17:16 UTC)
 _/ |\__&#39;_|_|_|\__&#39;_|  |  Official http://julialang.org release
|__/                   |  x86_64-linux-gnu

julia&gt;
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017, Gregor von Laszewski, Fugang Wang.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>